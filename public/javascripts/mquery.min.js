function mq_createHeader(e,t){e.empty();var n=$("<tr>");e.append(n);for(var r=t.headers,a=0;a<r.length;a++){var l=$('<th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" style="width: 15%;"aria-label="Position: activate to sort column ascending">');l.text(r[a]),n.append(l)}}function mq_createBody(e,t){e.empty();for(var n=t.fields,r=t.rows,a=t.keys,l=0;l<r.length;l++){var i=l%2==0?"odd":"even",d=$("<tr>");d.addClass(i);for(var s=r[l],o=0;o<a.length;o++){var h=$("<td>");n[o].type&&h.addClass(n[o].type),h.text(n[o].getValue(s[a[o]])),d.append(h)}e.append(d)}}var MQuery=function(e,t,n){this.element=$(e),this.headerElement=$("<thead>"),this.bodyElement=$("<tbody>"),this.options=$.extend({pageSize:50},n),this.loadUrl="/s/"+t,this.queryUrl="/q/"+t,this.element.empty(),this.element.append(this.headerElement),this.element.append(this.bodyElement);var r=this;this.load=function(){var n=$.Deferred();return $.get(r.loadUrl,function(e){console.log("load data:",e),r.searcher=JSON.parse(e),r.fields=[];for(var t=0;t<r.searcher.fields.length;t++)r.fields[t]=new MQueryField(r.searcher.fields[t]);n.resolve("load view finished.")}),n.promise()},this.execute=function(){var n=$.Deferred();return $.post(r.queryUrl,function(e){var t=JSON.parse(e);console.log("result:",t),t.fields=r.fields,mq_createHeader(r.headerElement,t),mq_createBody(r.bodyElement,t),n.resolve("query finished.")}),n.promise()}},MQFHandler=function(e){this.handleValue=function(e){return e}},MQFHandler_string=function(e){MQFHandler.call(this,e)};$.extend(MQFHandler_string,MQFHandler);var MQFHandler_number=function(e){MQFHandler.call(this,e),this.handleValue=function(e){return(0|e)===e?e:e.toFixed(2)}};$.extend(MQFHandler_number,MQFHandler);var MQFHandler_datetime=function(e){MQFHandler.call(this,e),this.handleValue=function(e){return new Date(e).Format("yyyy-MM-dd hh:mm:ss")}};$.extend(MQFHandler_datetime,MQFHandler);var MQFHandler_date=function(e){MQFHandler.call(this,e)};$.extend(MQFHandler_date,MQFHandler);var MQFHandler_time=function(e){MQFHandler.call(this,e)};$.extend(MQFHandler_time,MQFHandler);var MQFHandler_price=function(e){MQFHandler.call(this,e)};function createFieldHandler(e){if(e.type)try{return new Function("field","return new MQFHandler_"+e.type+"(field)")(e)}catch(e){console.log(e)}return new MQFHandler(e)}$.extend(MQFHandler_price,MQFHandler);var MQueryField=function(e){var t=createFieldHandler(e);this.type=e.type,this.getTitle=function(){},this.getValue=function(e){return t.handleValue(e)}};Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};